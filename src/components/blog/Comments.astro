---
interface Props {
  slug: string;
  permalink: string;
}

const { slug, permalink } = Astro.props;

const url = new URL("https://blog.skywt.cn/api/comments");
url.search = new URLSearchParams({
  page: "1",
  pageSize: "100",
  order: "desc",
  slug: slug,
}).toString();
const response = await fetch(url);
const data = await response.json();
const comments = data.data.dataSet;

import Comment from "./Comment.astro";

function getCount(comments: Comment[]): number {
  let count = 0;
  for (const comment of comments) {
    count++;
    count += getCount(comment.children);
  }
  return count;
}
const commentsNum = getCount(comments);
---

<h2>
  <i class="ri-discuss-line"></i>
  {commentsNum > 0 ? "å…± " + commentsNum + " æ¡è¯„è®º" : "æš‚æ— è¯„è®º"}
</h2>

{comments.map((comment: Comment) => <Comment commentObj={comment} level={0} />)}

<hr class="my-8" />

<h2>
  <i class="ri-discuss-line"></i>
  å‘è¡¨è¯„è®º
</h2>
<p class="primary-color card my-4 p-2">
  ğŸš§ æ–°åšå®¢ç³»ç»Ÿçš„è¯„è®ºåŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ã€‚å¯ä»¥å‰å¾€<a
    href={permalink}
    class="link underline">åŸåšå®¢çš„è¿™ç¯‡æ–‡ç« </a
  >åº•éƒ¨è¯„è®ºåŒºå‘è¡¨è¯„è®ºã€‚
</p>
