import{j as o}from"./jsx-runtime.7faW4zRM.js";import{r as d}from"./index.DhYZZe0J.js";/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var T=F,_=H,R=Object.prototype.toString,b=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function F(e,n){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var t={},s=n||{},u=s.decode||K,c=0;c<e.length;){var i=e.indexOf("=",c);if(i===-1)break;var l=e.indexOf(";",c);if(l===-1)l=e.length;else if(l<i){c=e.lastIndexOf(";",i-1)+1;continue}var f=e.slice(c,i).trim();if(t[f]===void 0){var m=e.slice(i+1,l).trim();m.charCodeAt(0)===34&&(m=m.slice(1,-1)),t[f]=J(m,u)}c=l+1}return t}function H(e,n,t){var s=t||{},u=s.encode||z;if(typeof u!="function")throw new TypeError("option encode is invalid");if(!b.test(e))throw new TypeError("argument name is invalid");var c=u(n);if(c&&!b.test(c))throw new TypeError("argument val is invalid");var i=e+"="+c;if(s.maxAge!=null){var l=s.maxAge-0;if(isNaN(l)||!isFinite(l))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(l)}if(s.domain){if(!b.test(s.domain))throw new TypeError("option domain is invalid");i+="; Domain="+s.domain}if(s.path){if(!b.test(s.path))throw new TypeError("option path is invalid");i+="; Path="+s.path}if(s.expires){var f=s.expires;if(!V(f)||isNaN(f.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+f.toUTCString()}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.partitioned&&(i+="; Partitioned"),s.priority){var m=typeof s.priority=="string"?s.priority.toLowerCase():s.priority;switch(m){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(s.sameSite){var p=typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite;switch(p){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function K(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function z(e){return encodeURIComponent(e)}function V(e){return R.call(e)==="[object Date]"||e instanceof Date}function J(e,n){try{return n(e)}catch{return e}}function q(){const e=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof e=="boolean"?e:typeof document=="object"&&typeof document.cookie=="string"}function Y(e){return typeof e=="string"?T(e):typeof e=="object"&&e!==null?e:{}}function k(e,n={}){const t=B(e);if(!n.doNotParse)try{return JSON.parse(t)}catch{}return e}function B(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}class ${constructor(n,t={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const u=this.cookies;this.cookies=T(document.cookie),this._checkChanges(u)};const s=typeof document>"u"?"":document.cookie;this.cookies=Y(n||s),this.defaultSetOptions=t,this.HAS_DOCUMENT_COOKIE=q()}_emitChange(n){for(let t=0;t<this.changeListeners.length;++t)this.changeListeners[t](n)}_checkChanges(n){new Set(Object.keys(n).concat(Object.keys(this.cookies))).forEach(s=>{n[s]!==this.cookies[s]&&this._emitChange({name:s,value:k(this.cookies[s])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(n,t={}){return t.doNotUpdate||this.update(),k(this.cookies[n],t)}getAll(n={}){n.doNotUpdate||this.update();const t={};for(let s in this.cookies)t[s]=k(this.cookies[s],n);return t}set(n,t,s){s?s=Object.assign(Object.assign({},this.defaultSetOptions),s):s=this.defaultSetOptions;const u=typeof t=="string"?t:JSON.stringify(t);this.cookies=Object.assign(Object.assign({},this.cookies),{[n]:u}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=_(n,u,s)),this._emitChange({name:n,value:t,options:s})}remove(n,t){const s=t=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),t),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[n],this.HAS_DOCUMENT_COOKIE&&(document.cookie=_(n,"",s)),this._emitChange({name:n,value:void 0,options:t})}addChangeListener(n){this.changeListeners.push(n),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(n){const t=this.changeListeners.indexOf(n);t>=0&&this.changeListeners.splice(t,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const M=d.createContext(new $),{Provider:G,Consumer:me}=M;class W extends d.Component{constructor(n){super(n),n.cookies?this.cookies=n.cookies:this.cookies=new $(void 0,n.defaultSetOptions)}render(){return d.createElement(G,{value:this.cookies},this.props.children)}}var L={exports:{}},a={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E;function Q(){if(E)return a;E=1;var e=typeof Symbol=="function"&&Symbol.for,n=e?Symbol.for("react.element"):60103,t=e?Symbol.for("react.portal"):60106,s=e?Symbol.for("react.fragment"):60107,u=e?Symbol.for("react.strict_mode"):60108,c=e?Symbol.for("react.profiler"):60114,i=e?Symbol.for("react.provider"):60109,l=e?Symbol.for("react.context"):60110,f=e?Symbol.for("react.async_mode"):60111,m=e?Symbol.for("react.concurrent_mode"):60111,p=e?Symbol.for("react.forward_ref"):60112,S=e?Symbol.for("react.suspense"):60113,C=e?Symbol.for("react.suspense_list"):60120,h=e?Symbol.for("react.memo"):60115,w=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,j=e?Symbol.for("react.responder"):60118,U=e?Symbol.for("react.scope"):60119;function y(r){if(typeof r=="object"&&r!==null){var v=r.$$typeof;switch(v){case n:switch(r=r.type,r){case f:case m:case s:case c:case u:case S:return r;default:switch(r=r&&r.$$typeof,r){case l:case p:case w:case h:case i:return r;default:return v}}case t:return v}}}function O(r){return y(r)===m}return a.AsyncMode=f,a.ConcurrentMode=m,a.ContextConsumer=l,a.ContextProvider=i,a.Element=n,a.ForwardRef=p,a.Fragment=s,a.Lazy=w,a.Memo=h,a.Portal=t,a.Profiler=c,a.StrictMode=u,a.Suspense=S,a.isAsyncMode=function(r){return O(r)||y(r)===f},a.isConcurrentMode=O,a.isContextConsumer=function(r){return y(r)===l},a.isContextProvider=function(r){return y(r)===i},a.isElement=function(r){return typeof r=="object"&&r!==null&&r.$$typeof===n},a.isForwardRef=function(r){return y(r)===p},a.isFragment=function(r){return y(r)===s},a.isLazy=function(r){return y(r)===w},a.isMemo=function(r){return y(r)===h},a.isPortal=function(r){return y(r)===t},a.isProfiler=function(r){return y(r)===c},a.isStrictMode=function(r){return y(r)===u},a.isSuspense=function(r){return y(r)===S},a.isValidElementType=function(r){return typeof r=="string"||typeof r=="function"||r===s||r===m||r===c||r===u||r===S||r===C||typeof r=="object"&&r!==null&&(r.$$typeof===w||r.$$typeof===h||r.$$typeof===i||r.$$typeof===l||r.$$typeof===p||r.$$typeof===g||r.$$typeof===j||r.$$typeof===U||r.$$typeof===x)},a.typeOf=y,a}L.exports=Q();var X=L.exports,P=X,Z={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ee={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},A={};A[P.ForwardRef]=Z;A[P.Memo]=ee;function te(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"}function ne(e,n){const t=d.useContext(M);if(!t)throw new Error("Missing <CookiesProvider>");const u=Object.assign(Object.assign({},{doNotUpdate:!0}),n),[c,i]=d.useState(()=>t.getAll(u));te()&&d.useLayoutEffect(()=>{function p(){const S=t.getAll(u);se(e||null,S,c)&&i(S)}return t.addChangeListener(p),()=>{t.removeChangeListener(p)}},[t,c]);const l=d.useMemo(()=>t.set.bind(t),[t]),f=d.useMemo(()=>t.remove.bind(t),[t]),m=d.useMemo(()=>t.update.bind(t),[t]);return[c,l,f,m]}function se(e,n,t){if(!e)return!0;for(let s of e)if(n[s]!==t[s])return!0;return!1}function D(e){const[n,t]=d.useState(""),[s,u]=d.useState(""),[c,i]=d.useState(""),[l,f]=d.useState(""),[m,p]=d.useState(!0),[S,C]=d.useState(!0),[h,w,x]=ne(["author","mail","url"]);return d.useEffect(()=>{h.author&&(t(h.author),C(!1)),h.mail&&u(h.mail),h.url&&i(h.url)},[]),o.jsxs(o.Fragment,{children:[e.selected!==null&&o.jsxs("div",{className:"mt-4 flex justify-between",children:[o.jsxs("p",{className:"font-bold",children:[o.jsx("i",{className:"ri-reply-line"})," 回复 @",e.selected.author," ","的评论："]}),o.jsx("p",{children:o.jsx("span",{className:"link",onClick:()=>{e.setSelected(null)},children:"取消回复"})})]}),o.jsxs("p",{className:"mt-4 card card--in-content",children:[o.jsx("b",{children:"所有评论都将经过博主审核。"}),"请勿填写无意义邮箱或发表无关评论、广告等，否则会被视为垃圾评论。"]}),o.jsxs("form",{onSubmit:g=>{e.submitComment(n,s,c,l,m),f(""),g.preventDefault()},className:"mt-4 form",children:[o.jsx("input",{placeholder:"你的名字",type:"text",className:"form__input",required:!0,value:n,onChange:g=>{t(g.target.value)}}),o.jsx("input",{placeholder:"邮箱",type:"email",className:"form__input",required:!0,value:s,onChange:g=>{u(g.target.value)}}),o.jsx("input",{placeholder:"网址",type:"url",className:"form__input",value:c,onChange:g=>{i(g.target.value)}}),o.jsx("textarea",{rows:8,className:"sm:col-span-3 form__input",placeholder:"说点什么吧……",required:!0,value:l,onChange:g=>{f(g.target.value)}}),o.jsx("button",{type:"submit",className:"sm:col-span-3 form__button",disabled:e.sending,children:e.sending?"提交中……":"提交"})]}),S&&o.jsx("p",{className:"mt-4 text-secondary text-sm leading-normal",children:"提交评论即表明你同意本网站使用 Cookie，并允许本站在后台记录你的邮箱、IP 地址等必要信息。这些信息不会被透露给其他用户。（提交一次评论后，本提示将不再展示）"})]})}const re={getFullDate:e=>{e=new Date(e);const n=e.getFullYear(),t=e.getMonth()+1,s=e.getDate(),u=e.getHours().toString().padStart(2,"0"),c=e.getMinutes().toString().padStart(2,"0");return`${n} 年 ${t} 月 ${s} 日 ${u}:${c}`},getMonthDay:e=>{e=new Date(e);const n=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${n}-${t}`}};function I(e){return o.jsxs("div",{className:"my-4",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("img",{src:e.comment.avatar,className:"rounded-full w-12 mr-2"}),o.jsxs("div",{className:"m-2",children:[e.comment.url?o.jsx("a",{href:e.comment.url,className:"link",target:"_blank",children:o.jsx("h4",{children:e.comment.author})}):o.jsx("h4",{children:e.comment.author}),o.jsxs("p",{className:"mt-1",children:[o.jsx("span",{className:"text-secondary",children:re.getFullDate(e.comment.created)}),e.comment.status==="approved"?o.jsxs("span",{className:"link ml-2",onClick:()=>{e.setSelected(e.comment)},children:[o.jsx("i",{className:"ri-reply-line"})," 回复"]}):o.jsxs("span",{className:"ml-2",children:[o.jsx("i",{className:"ri-admin-line"})," 待审核"]})]})]})]}),o.jsx("p",{className:"mt-2 break-all whitespace-pre-wrap",children:e.comment.text}),e.comment===e.selected&&o.jsx(D,{selected:e.selected,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending}),o.jsx("div",{className:"ml-8",children:e.comment.children.map(n=>o.jsx(I,{selected:e.selected,comment:n,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending},n.id))})]})}const oe=async e=>{const n=new URL(`articles/${e}`,"https://api.skywt.cn/");return(await(await fetch(n)).json()).data},ie=async(e,n)=>{const t=new URL("articles","https://api.skywt.cn/");return t.search=new URLSearchParams({page:e.toString(),pageSize:n.toString()}).toString(),(await(await fetch(t)).json()).data},ae=async e=>{const n=new URL("comments","https://api.skywt.cn/");return n.search=new URLSearchParams({articleId:e.toString()}).toString(),(await(await fetch(n,{method:"GET",credentials:"include"})).json()).data},ce=async(e,n,t,s,u,c,i)=>{const l=new URL("comments","https://api.skywt.cn/"),m=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({author:e,mail:n,url:t,text:s,receiveMail:u,articleId:c,parentId:i})});if(m.ok===!1)throw Error("HTTP Error "+m.status+" "+m.statusText);return(await m.json()).data},N={getArticle:oe,getArticles:ie,getComments:ae,postComment:ce};function de(e){const[n,t]=d.useState([]),[s,u]=d.useState(!1),[c,i]=d.useState(0),[l,f]=d.useState(null),[m,p]=d.useState(!1);async function S(C,h,w,x,g){if(m!==!0){p(!0);try{const j=await N.postComment(C,h,w,x,g,e.articleId,l===null?null:l.id);l!==null?l.children.push(j):n.push(j),t([...n]),p(!1),f(null)}catch{console.log("Error: ",s),alert("抱歉，评论发送失败。"),p(!1)}}}return d.useEffect(()=>{function C(h){let w=0;return h.forEach(x=>{w++,w+=C(x.children)}),w}N.getComments(e.articleId).then(h=>{t(h),i(C(h))}).catch(h=>{console.log("Error: ",h),u(!0)})},[]),o.jsxs(W,{defaultSetOptions:{path:"/",maxAge:2592e3,sameSite:"lax",domain:".skywt.cn"},children:[s?o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 评论"]}),o.jsx("p",{className:"card card--in-content my-4",children:"🚧 抱歉，获取评论失败。"})]}):o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"}),c>0?" 共 "+c+" 条评论":" 暂无评论"]}),n.map(C=>o.jsx(I,{comment:C,selected:l,setSelected:f,submitComment:S,sending:m},C.id))]}),o.jsx("hr",{className:"page__divide page__divide--between-sections"}),o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 发表新的评论"]}),l===null?o.jsx(D,{selected:l,setSelected:f,submitComment:S,sending:m}):o.jsx("div",{className:"mt-4",children:o.jsx("span",{className:"link underline",onClick:()=>{f(null)},children:"取消评论回复"})})]})]})}export{de as default};
